# text file parse benchmark by Go1.6 and php 7.0


## usage(for ubuntu 15.04):

0) compile go parser: 
<pre>
git clone https://github.com/wheelcomplex/wander.git

cd wander/go-vs-php-file-parse 

go build -o parser 

./parser -h
</pre>

1) create testdata(100m lines, 4768 MB): 
<pre>
./parser -f 100m.lines.testdata.txt -force -gen -line 100
</pre>
<pre>
go-file-parser 2015/12/28 11:57:19 generating 100m.lines.testdata.txt, 100000000 lines, 4768 MB, be ware free disk spaces!
go-file-parser 2015/12/28 11:57:32 waiting for disk flush ...
go-file-parser 2015/12/28 11:57:36 100m.lines.testdata.txt generated in 13.421370918s, MD5SUM 78bf6a0b60c643d3555b43258380f4c5, 100000000 lines, 4768 MB, 355 MB/s.
</pre>

2) run go parser: ./parser -f 100m.lines.testdata.txt

3) or run go parser with http profile: 
<pre>
./parser -f 100m.lines.testdata.txt -profile
</pre>
<pre>
go-file-parser 2015/12/28 11:59:22 Go, parsing 100m.lines.testdata.txt(4768 MB), read buffer size 65535 ...
go-file-parser 2015/12/28 12:00:03 read done, 100000000 lines, 5000000000 bytes, parse size 486436015838
go-file-parser 2015/12/28 12:00:03 Go, parsed file 100m.lines.testdata.txt in 40.68259091s, 100000000 lines, 4768 MB, 117 MB/s.
</pre>

4) run php 7.0 parser: 
<pre>
php7.0 parser.php -f 100m.lines.testdata.txt
</pre>
<pre>
php 7.0, parsing file 100m.lines.testdata.txt(4768 MB) ...
php, parsed file 100m.lines.testdata.txt in 58.465, 100000001 lines, 4673 MB, speed 79 MB/s
</pre>

## tips for Go parser:

1. in Go parser, it is very important to use bufio.Reader with 64k buffer size and bytes.SplintN for speed boost.
2. profile show that a lot of [][]byte generated by SplitN.

## you are welcome to send feelback by create new issue, thanks.

## install php 7.0 and run parser.php in ubuntu 15.04 x86_64:

// from https://www.digitalocean.com/community/tutorials/how-to-upgrade-to-php-7-on-ubuntu-14-04

sudo add-apt-repository ppa:ondrej/php-7.0

sudo apt-get update

sudo apt-get -y install php7.0-cli
